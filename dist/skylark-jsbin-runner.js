/**
 * skylark-jsbin-runner - A version of jsbin-runner  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-runner/
 * @license MIT
 */
!function(e,n){var t=n.define,require=n.require,o="function"==typeof t&&t.amd,r=!o&&"undefined"!=typeof exports;if(!o&&!t){var i={};t=n.define=function(e,n,t){"function"==typeof t?(i[e]={factory:t,deps:n.map(function(n){return function(e,n){if("."!==e[0])return e;var t=n.split("/"),o=e.split("/");t.pop();for(var r=0;r<o.length;r++)"."!=o[r]&&(".."==o[r]?t.pop():t.push(o[r]));return t.join("/")}(n,e)}),resolved:!1,exports:null},require(e)):i[e]={factory:null,resolved:!0,exports:t}},require=n.require=function(e){if(!i.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=i[e];if(!module.resolved){var t=[];module.deps.forEach(function(e){t.push(require(e))}),module.exports=module.factory.apply(n,t)||null,module.resolved=!0}return module.exports}}if(!t)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-jsbin-runner/jsbin",["skylark-langx-ns"],function(e){"use strict";var n=e.attach("intg.jsbin");return n}),e("skylark-jsbin-runner/runner",["skylark-loopprotect","./jsbin"],function(e,n){"use strict";var t={};return e.hit=function(e){console.warn("Exiting potential infinite loop at line "+e+'. To disable loop protection: add "// noprotect" to your code'),t.postMessage("loopProtectHit",e)},t.parent={},t.parent.origin="*",t.error=function(){var e=["Runner:"].concat([].slice.call(arguments));if(!("console"in window))return alert(e.join(" "))},t.handleMessage=function(e){if(e.origin){var n=e.data;try{n="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){return t.error("Error parsing event data:",e.message)}if(t.commands&&"function"!=typeof t.commands[n.type])return t.error("No matching event handler:",n.type);t.parent.source=e.source;try{t.commands[n.type](n.data)}catch(e){t.error(e.message)}}},t.postMessage=function(e,n){if(!t.parent.source)return t.error("No postMessage connection to parent window.");t.parent.source.postMessage(JSON.stringify({type:e,data:n}),t.parent.origin)},n.runner=t}),e("skylark-jsbin-runner/utils",["./runner"],function(e){"use strict";window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host);return e.utils={prependChild:function(e,n){e.insertBefore(n,e.firstChild)},addEvent:function(e,n,t){e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent("on"+n,function(){return t.call(e,window.event)})},throttle:function(e,n){var t=function(){var o=this,r=arguments;t.cancel(),t.timer=setTimeout(function(){e.apply(o,r)},n)};return t.cancel=function(){clearTimeout(t.timer)},t},cleanse:function(e){return(e||"").replace(/[<&]/g,function(e){return{"&":"&amp;","<":"&lt;"}[e]})},getIframeWindow:function(e){return e.contentWindow||e.contentDocument.parentWindow}}}),e("skylark-jsbin-runner/proxy-console",["./runner"],function(e){"use strict";var n=function(){try{window.console.log("d[ o_0 ]b")}catch(e){!1}var n=function(){},t=n.prototype.methods=["debug","clear","error","info","log","warn","dir","props","_raw","group","groupEnd","dirxml","table","trace","assert","count","markTimeline","profile","profileEnd","time","timeEnd","timeStamp","groupCollapsed"];return t.forEach(function(t){n.prototype[t]=function(){var n=[].slice.call(arguments),o=function(e){for(var n,t=[],o=0,r=e.length;o<r;o++)void 0===(n=e[o])?t.push("undefined"):t.push(JSON.stringify(n));return t}(n);e.postMessage("console",{method:"_raw"===t?n.shift():t,args:"_raw"===t?o.slice(1):o}),window.console&&(console[t]||(t="log"),window.console&&"_raw"!==t&&("clear"!==t||"clear"===t&&console.clear)&&console[t].apply(console,n))}}),new n}();return e.proxyConsole=n}),e("skylark-jsbin-runner/sandbox",["./runner","./utils","./proxy-console"],function(e,n,t){"use strict";var o={target:null,old:null,active:null,state:{}};return o.guid=+new Date,o.create=function(){var e=document.createElement("iframe");return e.setAttribute("sandbox","allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),e.setAttribute("frameBorder","0"),e.setAttribute("name","JS Bin Output "),e.id=o.guid++,e},o.use=function(e,t){if(!o.target)throw new Error("Sandbox has no target element.");o.old=o.active,o.saveState(o.old),o.active=e,n.prependChild(o.target,e),setTimeout(function(){t&&t();for(var e,n=o.target.getElementsByTagName("iframe"),r=n.length,i=0,s=o.active.id;e=n[i],i<r;i++)e.id!==s&&(e.parentNode.removeChild(e),r--)},0)},o.restoreState=function(e,t){if(!e)return{};var o=n.getIframeWindow(e);if(!o)return{};t.scroll&&o.scrollTo(t.scroll.x,t.scroll.y)},o.saveState=function(e){if(!e)return{};var t=n.getIframeWindow(e);return t?{scroll:{x:t.scrollX,y:t.scrollY}}:{}},o.wrap=function(t,r){t&&(r=r||{},n.addEvent(t,"resize",n.throttle(function(){e.postMessage("resize",o.getSizeProperties(t))},25)),e.postMessage("resize",o.getSizeProperties(t)),n.addEvent(t,"focus",function(){e.postMessage("focus")}))},o.getSizeProperties=function(e){return{width:e.innerWidth||e.document.documentElement.clientWidth,height:e.innerHeight||e.document.documentElement.clientHeight,offsetWidth:e.document.documentElement.offsetWidth,offsetHeight:e.document.documentElement.offsetHeight}},o.eval=function(e){if(!o.active)throw new Error("sandbox.eval: has no active iframe.");var n=/(^.|\b)console\.(\S+)/g;if(n.test(e)){e=e.replace(n,function(e,n,t){return"window.runnerWindow.proxyConsole."+t})}var r=o.active.contentWindow,i=null,s="log";try{i=r.eval(e)}catch(e){i=e.message,s="error"}return t[s](i)},o.injectScript=function(e,n){if(!o.active)throw new Error("sandbox.injectScript: has no active iframe.");var t=o.active.contentWindow,r=t.document,i=r.createElement("script");i.src=e,i.onload=function(){n()},i.onerror=function(){n('Failed to load "'+e+'"')},r.body.appendChild(i)},o.injectDOM=function(e,n){if(!o.active)throw new Error("sandbox.injectDOM: has no active iframe.");var t=o.active.contentWindow,r=t.document;try{r.body.innerHTML=e}catch(e){n("Failed to load DOM.")}n()},e.sandbox=o}),e("skylark-jsbin-runner/processor",["skylark-loopprotect","./runner"],function(e,n){"use strict";var t,o={};o.blockingMethods={kill:'<script>(function(){window.__blocked={methods:["open","print","alert","prompt","confirm"],old:{}};for(var m in __blocked.methods){try {__blocked.old[m]=window[m];window[m]=function(){};}catch(e){}}})()<\/script>',restore:"\x3c!--jsbin live harness--\x3e<script>(function(){for(var m in __blocked.methods){try{window[m]=__blocked.old[m];delete __blocked;}catch(e){}};})()<\/script>"},o.getDoctype=(t=/<!doctype [\s\S]*?>/i,function(e){var n=(e.match(t)||[""])[0],o=e.substr(n.length);return{doctype:n,tail:o}}),o.debug=function(e){return"<pre>"+e.replace(/[<>&]/g,function(e){return"<"==e?"&lt;":">"==e?"&gt;":"&"==e?"&amp;":void 0})+"</pre>"},o.render=function(e,n){n=n||{},e=e||"";var t=[],r=!0!==n.requested,i=!1===n.includeJsInRealtime;r&&i&&(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),e=e.replace(/(<.*?\s)(autofocus)/g,"$1");var s=o.getDoctype(e),c=s.doctype;return e=s.tail,t.push(c),r&&n.includeJsInRealtime&&t.push(o.blockingMethods.kill),t.push(e),r&&n.includeJsInRealtime&&t.push(o.blockingMethods.restore),n.debug?o.debug(t.join("\n")):t.join("\n")};var r={"<":"&lt;",">":"&gt;","&":"&amp;"},i={docReady:/\$\(document\)\.ready/,shortDocReady:/\$\(function/,console:/(^.|\b)console\.(\S+)/g,script:/<\/script/gi,code:/%code%/,csscode:/%css%/,description:/(<meta name="description" content=")([^"]*)/im,title:/<title>(.*)<\/title>/im,winLoad:/window\.onload\s*=/,scriptopen:/<script/gi};return o.prepare=function(n){i.docReady.lastIndex=0,i.shortDocReady.lastIndex=0,i.console.lastIndex=0,i.script.lastIndex=0,i.code.lastIndex=0,i.csscode.lastIndex=0,i.title.lastIndex=0,i.winLoad.lastIndex=0,i.scriptopen.lastIndex=0;var t=[],o=n.html,s=n.javascript||"",c=n.css,a="",l=!!o.trim().length,u=!!c.trim().length,d=!!s.trim().length;if(l&&(s="try {"+s+"\n} catch (error) { throw error; }"),e.alias="window.runnerWindow.protect",s=(s=e(s)).replace(i.script,"<\\/script"),i.console.test(s)&&(s=s.replace(i.console,function(e,n,t){return"window.runnerWindow.proxyConsole."+t})),!l&&d)o="<pre>\n"+s.replace(/[<>&]/g,function(e){return r[e]})+"</pre>";else if(i.code.test(o))o=o.split("%code%").join(code.javascript);else if(d){a="",-1!==o.indexOf("</body>")&&(t.push(o.substring(0,o.lastIndexOf("</body>"))),t.push(o.substring(o.lastIndexOf("</body>"))),o=t[0],a=2===t.length&&t[1]?t[1]:"");o+="<scripttext/script>"+s+"\n<\/script>\n"+a}if(i.console.test(o)){o=o.replace(i.console,function(e,n,t,r){var i=o.lastIndexOf("<script",r),s=o.lastIndexOf("</script",r);return null,i>s?"window.runnerWindow.proxyConsole."+t:e})}return l||d||!u?i.csscode.test(o)?o=o.split("%css%").join(c):l&&(t=[],a="",-1!==o.indexOf("</head>")&&(t.push(o.substring(0,o.indexOf("</head>"))),t.push(o.substring(o.indexOf("</head>"))),o=t[0],a=2===t.length&&t[1]?t[1]:""),o+='<style id="jsbin-css">\n'+c+"\n</style>\n"+a):o="<pre>\n"+c.replace(/[<>&]/g,function(e){return r[e]})+"</pre>",o},n.processor=o}),e("skylark-jsbin-runner/commands",["skylark-loopprotect","./runner","./utils","./proxy-console","./sandbox","./processor"],function(e,n,t,o,r,i){"use strict";var s={render:function(s){if(s.options.injectCSS&&r.active){var c=r.active.contentDocument.getElementById("jsbin-css");if(c)return void(c.innerHTML=s.source)}var a=r.create(s.options);r.use(a,function(){var c=a.contentDocument,l=t.getIframeWindow(a);c||(c=l.document),o.methods.forEach(function(e){delete o[e]}),!s.source&&s.codes&&(s.source=i.prepare(s.codes));var u=i.render(s.source,s.options);c.open(),c.write(""),l.runnerWindow={proxyConsole:o,protect:e},l.console=o,e.reset(),l.onerror=function(e,n,t,r,i){o._raw("error",i&&i.stack?i.stack:e+" (line "+t+")")},c.write(u),c.close(),n.postMessage("complete"),r.wrap(l,s.options)})},"console:run":function(e){r.eval(e)},"console:load:script":function(e){r.injectScript(e,function(t){if(t)return n.postMessage("console:load:script:error",t);n.postMessage("console:load:script:success",e)})},"console:load:dom":function(e){r.injectDOM(e,function(e){if(e)return n.postMessage("console:load:dom:error",e);n.postMessage("console:load:dom:success")})}};return n.commands=s}),e("skylark-jsbin-runner/init",["./runner","./utils","./sandbox"],function(e,n,t){"use strict";return e.init=function(){window.onload=function(){if(!window.postMessage){var o=document.createElement("iframe");return o.setAttribute("sandbox","allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),o.setAttribute("frameBorder","0"),document.body.appendChild(o),void(o.src=window.name)}t.target=document.getElementById("sandbox-wrapper"),n.addEvent(window,"message",e.handleMessage)}}}),e("skylark-jsbin-runner/main",["./runner","./commands","./processor","./proxy-console","./runner","./sandbox","./utils","./init"],function(e){return e}),e("skylark-jsbin-runner",["skylark-jsbin-runner/main"],function(e){return e})}(t),!o){var s=require("skylark-langx-ns");r?module.exports=s:n.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jsbin-runner.js.map
