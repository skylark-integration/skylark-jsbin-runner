/**
 * skylark-jsbin-runner - A version of jsbin-runner  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-runner/
 * @license MIT
 */
!function(n,e){var r=e.define,require=e.require,t="function"==typeof r&&r.amd,o=!t&&"undefined"!=typeof exports;if(!t&&!r){var s={};r=e.define=function(n,e,r){"function"==typeof r?(s[n]={factory:r,deps:e.map(function(e){return function(n,e){if("."!==n[0])return n;var r=e.split("/"),t=n.split("/");r.pop();for(var o=0;o<t.length;o++)"."!=t[o]&&(".."==t[o]?r.pop():r.push(t[o]));return r.join("/")}(e,n)}),resolved:!1,exports:null},require(n)):s[n]={factory:null,resolved:!0,exports:r}},require=e.require=function(n){if(!s.hasOwnProperty(n))throw new Error("Module "+n+" has not been defined");var module=s[n];if(!module.resolved){var r=[];module.deps.forEach(function(n){r.push(require(n))}),module.exports=module.factory.apply(e,r)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(n,require){n("skylark-jsbin-runner/jsbin",["skylark-langx-ns"],function(n){"use strict";var e=n.attach("intg.jsbin");return e}),n("skylark-jsbin-runner/runner",["skylark-loopprotect","./jsbin"],function(n,e){"use strict";var r={};return n.hit=function(n){console.warn("Exiting potential infinite loop at line "+n+'. To disable loop protection: add "// noprotect" to your code'),r.postMessage("loopProtectHit",n)},r.parent={},r.parent.origin="*",r.error=function(){var n=["Runner:"].concat([].slice.call(arguments));if(!("console"in window))return alert(n.join(" "))},r.handleMessage=function(n){if(n.origin){var e=n.data;try{e="string"==typeof n.data?JSON.parse(n.data):n.data}catch(n){return r.error("Error parsing event data:",n.message)}if(r.commands&&"function"!=typeof r.commands[e.type])return r.error("No matching event handler:",e.type);r.parent.source=n.source;try{r.commands[e.type](e.data)}catch(n){r.error(n.message)}}},r.postMessage=function(n,e){if(!r.parent.source)return r.error("No postMessage connection to parent window.");r.parent.source.postMessage(JSON.stringify({type:n,data:e}),r.parent.origin)},e.runner=r}),n("skylark-jsbin-runner/utils",["./runner"],function(n){"use strict";window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host);return n.utils={prependChild:function(n,e){n.insertBefore(e,n.firstChild)},addEvent:function(n,e,r){n.addEventListener?n.addEventListener(e,r,!1):n.attachEvent("on"+e,function(){return r.call(n,window.event)})},throttle:function(n,e){var r=function(){var t=this,o=arguments;r.cancel(),r.timer=setTimeout(function(){n.apply(t,o)},e)};return r.cancel=function(){clearTimeout(r.timer)},r},cleanse:function(n){return(n||"").replace(/[<&]/g,function(n){return{"&":"&amp;","<":"&lt;"}[n]})},getIframeWindow:function(n){return n.contentWindow||n.contentDocument.parentWindow}}}),n("skylark-jsbin-runner/proxy-console",["./runner"],function(n){"use strict";var e=function(){try{window.console.log("d[ o_0 ]b")}catch(n){!1}var e=function(){},r=e.prototype.methods=["debug","clear","error","info","log","warn","dir","props","_raw","group","groupEnd","dirxml","table","trace","assert","count","markTimeline","profile","profileEnd","time","timeEnd","timeStamp","groupCollapsed"];return r.forEach(function(r){e.prototype[r]=function(){var e=[].slice.call(arguments),t=function(n){for(var e,r=[],t=0,o=n.length;t<o;t++)void 0===(e=n[t])?r.push("undefined"):r.push(JSON.stringify(e));return r}(e);n.postMessage("console",{method:"_raw"===r?e.shift():r,args:"_raw"===r?t.slice(1):t}),window.console&&(console[r]||(r="log"),window.console&&"_raw"!==r&&("clear"!==r||"clear"===r&&console.clear)&&console[r].apply(console,e))}}),new e}();return n.proxyConsole=e}),n("skylark-jsbin-runner/processor",["skylark-loopprotect","./runner"],function(n,e){"use strict";var r,t={};t.blockingMethods={kill:'<script>(function(){window.__blocked={methods:["open","print","alert","prompt","confirm"],old:{}};for(var m in __blocked.methods){try {__blocked.old[m]=window[m];window[m]=function(){};}catch(e){}}})()<\/script>',restore:"\x3c!--jsbin live harness--\x3e<script>(function(){for(var m in __blocked.methods){try{window[m]=__blocked.old[m];delete __blocked;}catch(e){}};})()<\/script>"},t.getDoctype=(r=/<!doctype [\s\S]*?>/i,function(n){var e=(n.match(r)||[""])[0],t=n.substr(e.length);return{doctype:e,tail:t}}),t.debug=function(n){return"<pre>"+n.replace(/[<>&]/g,function(n){return"<"==n?"&lt;":">"==n?"&gt;":"&"==n?"&amp;":void 0})+"</pre>"},t.render=function(n,e){e=e||{},n=n||"";var r=[],o=!0!==e.requested,s=!1===e.includeJsInRealtime;o&&s&&(n=n.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),n=n.replace(/(<.*?\s)(autofocus)/g,"$1");var i=t.getDoctype(n),c=i.doctype;return n=i.tail,r.push(c),o&&e.includeJsInRealtime&&r.push(t.blockingMethods.kill),r.push(n),o&&e.includeJsInRealtime&&r.push(t.blockingMethods.restore),e.debug?t.debug(r.join("\n")):r.join("\n")};var o={"<":"&lt;",">":"&gt;","&":"&amp;"},s={docReady:/\$\(document\)\.ready/,shortDocReady:/\$\(function/,console:/(^.|\b)console\.(\S+)/g,script:/<\/script/gi,code:/%code%/,csscode:/%css%/,description:/(<meta name="description" content=")([^"]*)/im,title:/<title>(.*)<\/title>/im,winLoad:/window\.onload\s*=/,scriptopen:/<script/gi};return t.prepare=function(e){s.docReady.lastIndex=0,s.shortDocReady.lastIndex=0,s.console.lastIndex=0,s.script.lastIndex=0,s.code.lastIndex=0,s.csscode.lastIndex=0,s.title.lastIndex=0,s.winLoad.lastIndex=0,s.scriptopen.lastIndex=0;var r=[],t=e.html,i=e.javascript||"",c=e.css,a="",l=!!t.trim().length,u=!!c.trim().length,d=!!i.trim().length;if(l&&(i="try {"+i+"\n} catch (error) { throw error; }"),n.alias="window.runnerWindow.protect",i=(i=n(i)).replace(s.script,"<\\/script"),s.console.test(i)&&(i=i.replace(s.console,function(n,e,r){return"window.runnerWindow.proxyConsole."+r})),!l&&d)t="<pre>\n"+i.replace(/[<>&]/g,function(n){return o[n]})+"</pre>";else if(s.code.test(t))t=t.split("%code%").join(code.javascript);else if(d){a="",-1!==t.indexOf("</body>")&&(r.push(t.substring(0,t.lastIndexOf("</body>"))),r.push(t.substring(t.lastIndexOf("</body>"))),t=r[0],a=2===r.length&&r[1]?r[1]:"");t+="<scripttext/script>"+i+"\n<\/script>\n"+a}if(s.console.test(t)){t=t.replace(s.console,function(n,e,r,o){var s=t.lastIndexOf("<script",o),i=t.lastIndexOf("</script",o);return null,s>i?"window.runnerWindow.proxyConsole."+r:n})}return l||d||!u?s.csscode.test(t)?t=t.split("%css%").join(c):l&&(r=[],a="",-1!==t.indexOf("</head>")&&(r.push(t.substring(0,t.indexOf("</head>"))),r.push(t.substring(t.indexOf("</head>"))),t=r[0],a=2===r.length&&r[1]?r[1]:""),t+='<style id="jsbin-css">\n'+c+"\n</style>\n"+a):t="<pre>\n"+c.replace(/[<>&]/g,function(n){return o[n]})+"</pre>",t},e.processor=t}),n("skylark-jsbin-runner/sandbox",["skylark-loopprotect","skylark-domx-plugins-sandboxs/sandbox","./runner","./utils","./proxy-console","./processor"],function(n,e,r,t,o,s){"use strict";var i;return r.sandbox={init:function(n){i=new e(n,{cssTextTagId:"jsbin-css"})},render:function(e){n.reset(),!e.source&&e.codes&&(e.source=s.prepare(e.codes));var t=s.render(e.source,e.options);e.options.proxyConsole=o,e.options.loopProtect=n,i.render(t,e.options),r.postMessage("complete")},injectScript:function(n,e){return i.injectScript(n,e)},injectDOM:function(n,e){return i.injectDOM(n,e)},injectCssText:function(n){return i.injectCssText(n)},eval:function(n){return i.eval(n)},isActive:function(){return!!i.active}}}),n("skylark-jsbin-runner/commands",["./runner","./utils","./sandbox"],function(n,e,r){"use strict";var t={render:function(n){if(n.options.injectCSS&&r.isActive()){let e=n.source||n.codes&&n.codes.css;return r.injectCssText(e)}return r.render(n)},"console:run":function(n){r.eval(n)},"console:load:script":function(e){r.injectScript(e,function(r){if(r)return n.postMessage("console:load:script:error",r);n.postMessage("console:load:script:success",e)})},"console:load:dom":function(e){r.injectDOM(e,function(e){if(e)return n.postMessage("console:load:dom:error",e);n.postMessage("console:load:dom:success")})}};return n.commands=t}),n("skylark-jsbin-runner/init",["./runner","./utils","./sandbox"],function(n,e,r){"use strict";return n.init=function(){window.onload=function(){if(!window.postMessage){var t=document.createElement("iframe");return t.setAttribute("sandbox","allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),t.setAttribute("frameBorder","0"),document.body.appendChild(t),void(t.src=window.name)}r.init(document.getElementById("sandbox-wrapper")),e.addEvent(window,"message",n.handleMessage)}}}),n("skylark-jsbin-runner/main",["./runner","./commands","./processor","./proxy-console","./runner","./sandbox","./utils","./init"],function(n){return n}),n("skylark-jsbin-runner",["skylark-jsbin-runner/main"],function(n){return n})}(r),!t){var i=require("skylark-langx-ns");o?module.exports=i:e.skylarkjs=i}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jsbin-runner.js.map
