/**
 * skylark-jsbin-runner - A version of jsbin-runner  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-runner/
 * @license MIT
 */
!function(e,n){var o=n.define,require=n.require,t="function"==typeof o&&o.amd,r=!t&&"undefined"!=typeof exports;if(!t&&!o){var i={};o=n.define=function(e,n,o){"function"==typeof o?(i[e]={factory:o,deps:n.map(function(n){return function(e,n){if("."!==e[0])return e;var o=n.split("/"),t=e.split("/");o.pop();for(var r=0;r<t.length;r++)"."!=t[r]&&(".."==t[r]?o.pop():o.push(t[r]));return o.join("/")}(n,e)}),resolved:!1,exports:null},require(e)):i[e]={factory:null,resolved:!0,exports:o}},require=n.require=function(e){if(!i.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=i[e];if(!module.resolved){var o=[];module.deps.forEach(function(e){o.push(require(e))}),module.exports=module.factory.apply(n,o)||null,module.resolved=!0}return module.exports}}if(!o)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-jsbin-runner/jsbin",["skylark-langx-ns"],function(e){var n=e.attach("intg.jsbin");return n}),e("skylark-jsbin-runner/runner",["./jsbin"],function(e){"use strict";var n={};return loopProtect.hit=function(e){console.warn("Exiting potential infinite loop at line "+e+'. To disable loop protection: add "// noprotect" to your code'),n.postMessage("loopProtectHit",e)},n.parent={},n.parent.origin="*",n.error=function(){var e=["Runner:"].concat([].slice.call(arguments));if(!("console"in window))return alert(e.join(" "))},n.handleMessage=function(e){if(e.origin){var o=e.data;try{o="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){return n.error("Error parsing event data:",e.message)}if(n.commands&&"function"!=typeof n.commands[o.type])return n.error("No matching event handler:",o.type);n.parent.source=e.source;try{n.commands[o.type](o.data)}catch(e){n.error(e.message)}}},n.postMessage=function(e,o){if(!n.parent.source)return n.error("No postMessage connection to parent window.");n.parent.source.postMessage(JSON.stringify({type:e,data:o}),n.parent.origin)},e.runner=n}),e("skylark-jsbin-runner/utils",["./runner"],function(e){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.host);return e.utils={prependChild:function(e,n){e.insertBefore(n,e.firstChild)},addEvent:function(e,n,o){e.addEventListener?e.addEventListener(n,o,!1):e.attachEvent("on"+n,function(){return o.call(e,window.event)})},throttle:function(e,n){var o=function(){var t=this,r=arguments;o.cancel(),o.timer=setTimeout(function(){e.apply(t,r)},n)};return o.cancel=function(){clearTimeout(o.timer)},o},cleanse:function(e){return(e||"").replace(/[<&]/g,function(e){return{"&":"&amp;","<":"&lt;"}[e]})},getIframeWindow:function(e){return e.contentWindow||e.contentDocument.parentWindow}}}),e("skylark-jsbin-runner/sandbox",["./runner","./utils"],function(e,n){var o={target:null,old:null,active:null,state:{}};return o.guid=+new Date,o.create=function(){var e=document.createElement("iframe");return e.setAttribute("sandbox","allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),e.setAttribute("frameBorder","0"),e.setAttribute("name","JS Bin Output "),e.id=o.guid++,e},o.use=function(e,t){if(!o.target)throw new Error("Sandbox has no target element.");o.old=o.active,o.saveState(o.old),o.active=e,n.prependChild(o.target,e),setTimeout(function(){t&&t();for(var e,n=o.target.getElementsByTagName("iframe"),r=n.length,i=0,s=o.active.id;e=n[i],i<r;i++)e.id!==s&&(e.parentNode.removeChild(e),r--)},0)},o.restoreState=function(e,o){if(!e)return{};var t=n.getIframeWindow(e);if(!t)return{};o.scroll&&t.scrollTo(o.scroll.x,o.scroll.y)},o.saveState=function(e){if(!e)return{};var o=n.getIframeWindow(e);return o?{scroll:{x:o.scrollX,y:o.scrollY}}:{}},o.wrap=function(t,r){t&&(r=r||{},n.addEvent(t,"resize",n.throttle(function(){e.postMessage("resize",o.getSizeProperties(t))},25)),e.postMessage("resize",o.getSizeProperties(t)),n.addEvent(t,"focus",function(){e.postMessage("focus")}))},o.getSizeProperties=function(e){return{width:e.innerWidth||e.document.documentElement.clientWidth,height:e.innerHeight||e.document.documentElement.clientHeight,offsetWidth:e.document.documentElement.offsetWidth,offsetHeight:e.document.documentElement.offsetHeight}},o.eval=function(e){if(!o.active)throw new Error("sandbox.eval: has no active iframe.");var n=/(^.|\b)console\.(\S+)/g;if(n.test(e)){e=e.replace(n,function(e,n,o){return"window.runnerWindow.proxyConsole."+o})}var t=o.active.contentWindow,r=null,i="log";try{r=t.eval(e)}catch(e){r=e.message,i="error"}return proxyConsole[i](r)},o.injectScript=function(e,n){if(!o.active)throw new Error("sandbox.injectScript: has no active iframe.");var t=o.active.contentWindow,r=t.document,i=r.createElement("script");i.src=e,i.onload=function(){n()},i.onerror=function(){n('Failed to load "'+e+'"')},r.body.appendChild(i)},o.injectDOM=function(e,n){if(!o.active)throw new Error("sandbox.injectDOM: has no active iframe.");var t=o.active.contentWindow,r=t.document;try{r.body.innerHTML=e}catch(e){n("Failed to load DOM.")}n()},e.sandbox=o}),e("skylark-jsbin-runner/commands",["./runner","./utils","./sandbox"],function(e,n,o){"use strict";var t={render:function(t){if(t.options.injectCSS&&o.active){var r=o.active.contentDocument.getElementById("jsbin-css");if(r)return void(r.innerHTML=t.source)}var i=o.create(t.options);o.use(i,function(){var r=i.contentDocument,s=n.getIframeWindow(i);r||(r=s.document),proxyConsole.methods.forEach(function(e){delete proxyConsole[e]});var a=processor.render(t.source,t.options);r.open(),r.write(""),s.runnerWindow={proxyConsole:proxyConsole,protect:loopProtect},s.console=proxyConsole,loopProtect.reset(),s.onerror=function(e,n,o,t,r){proxyConsole._raw("error",r&&r.stack?r.stack:e+" (line "+o+")")},r.write(a),r.close(),e.postMessage("complete"),o.wrap(s,t.options)})},"console:run":function(e){o.eval(e)},"console:load:script":function(n){o.injectScript(n,function(o){if(o)return e.postMessage("console:load:script:error",o);e.postMessage("console:load:script:success",n)})},"console:load:dom":function(n){o.injectDOM(n,function(n){if(n)return e.postMessage("console:load:dom:error",n);e.postMessage("console:load:dom:success")})}};return e.commands=t}),e("skylark-jsbin-runner/processor",["./runner"],function(e){var n,o={};return o.blockingMethods={kill:'<script>(function(){window.__blocked={methods:["open","print","alert","prompt","confirm"],old:{}};for(var m in __blocked.methods){try {__blocked.old[m]=window[m];window[m]=function(){};}catch(e){}}})()<\/script>',restore:"\x3c!--jsbin live harness--\x3e<script>(function(){for(var m in __blocked.methods){try{window[m]=__blocked.old[m];delete __blocked;}catch(e){}};})()<\/script>"},o.getDoctype=(n=/<!doctype [\s\S]*?>/i,function(e){var o=(e.match(n)||[""])[0],t=e.substr(o.length);return{doctype:o,tail:t}}),o.debug=function(e){return"<pre>"+e.replace(/[<>&]/g,function(e){return"<"==e?"&lt;":">"==e?"&gt;":"&"==e?"&amp;":void 0})+"</pre>"},o.render=function(e,n){n=n||{},e=e||"";var t=[],r=!0!==n.requested,i=!1===n.includeJsInRealtime;r&&i&&(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),e=e.replace(/(<.*?\s)(autofocus)/g,"$1");var s=o.getDoctype(e),a=s.doctype;return e=s.tail,t.push(a),r&&n.includeJsInRealtime&&t.push(o.blockingMethods.kill),t.push(e),r&&n.includeJsInRealtime&&t.push(o.blockingMethods.restore),n.debug?o.debug(t.join("\n")):t.join("\n")},e.processor=o}),e("skylark-jsbin-runner/proxy-console",["./runner"],function(e){var n=function(){"use strict";try{window.console.log("d[ o_0 ]b")}catch(e){!1}var n=function(){},o=n.prototype.methods=["debug","clear","error","info","log","warn","dir","props","_raw","group","groupEnd","dirxml","table","trace","assert","count","markTimeline","profile","profileEnd","time","timeEnd","timeStamp","groupCollapsed"];return o.forEach(function(o){n.prototype[o]=function(){var n=[].slice.call(arguments),t=function(e){for(var n,o=[],t=0,r=e.length;t<r;t++)void 0===(n=e[t])?o.push("undefined"):o.push(stringify(n));return o}(n);e.postMessage("console",{method:"_raw"===o?n.shift():o,args:"_raw"===o?t.slice(1):t}),window.console&&(console[o]||(o="log"),window.console&&"_raw"!==o&&("clear"!==o||"clear"===o&&console.clear)&&console[o].apply(console,n))}}),new n}();return e.proxyConsole=n}),e("skylark-jsbin-runner/init",["./runner","./utils","./sandbox"],function(e,n,o){return e.init=function(){window.onload=function(){if(!window.postMessage){var t=document.createElement("iframe");return t.setAttribute("sandbox","allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),t.setAttribute("frameBorder","0"),document.body.appendChild(t),void(t.src=window.name)}o.target=document.getElementById("sandbox-wrapper"),n.addEvent(window,"message",e.handleMessage)}}}),e("skylark-jsbin-runner/main",["./runner","./commands","./processor","./proxy-console","./runner","./sandbox","./utils","./init"],function(e){return e}),e("skylark-jsbin-runner",["skylark-jsbin-runner/main"],function(e){return e})}(o),!t){var s=require("skylark-langx-ns");r?module.exports=s:n.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jsbin-runner.js.map
