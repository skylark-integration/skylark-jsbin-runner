/**
 * skylark-jsbin-runner - A version of jsbin-runner  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-runner/
 * @license MIT
 */
define(["skylark-loopprotect","./runner"],function(e,t){"use strict";var n,r={};r.blockingMethods={kill:'<script>(function(){window.__blocked={methods:["open","print","alert","prompt","confirm"],old:{}};for(var m in __blocked.methods){try {__blocked.old[m]=window[m];window[m]=function(){};}catch(e){}}})()<\/script>',restore:"\x3c!--jsbin live harness--\x3e<script>(function(){for(var m in __blocked.methods){try{window[m]=__blocked.old[m];delete __blocked;}catch(e){}};})()<\/script>"},r.getDoctype=(n=/<!doctype [\s\S]*?>/i,function(e){var t=(e.match(n)||[""])[0];return{doctype:t,tail:e.substr(t.length)}}),r.debug=function(e){return"<pre>"+e.replace(/[<>&]/g,function(e){return"<"==e?"&lt;":">"==e?"&gt;":"&"==e?"&amp;":void 0})+"</pre>"},r.render=function(e,t){t=t||{},e=e||"";var n=[],o=!0!==t.requested,s=!1===t.includeJsInRealtime;o&&s&&(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),e=e.replace(/(<.*?\s)(autofocus)/g,"$1");var i=r.getDoctype(e),c=i.doctype;return e=i.tail,n.push(c),o&&t.includeJsInRealtime&&n.push(r.blockingMethods.kill),n.push(e),o&&t.includeJsInRealtime&&n.push(r.blockingMethods.restore),t.debug?r.debug(n.join("\n")):n.join("\n")};var o={"<":"&lt;",">":"&gt;","&":"&amp;"},s={docReady:/\$\(document\)\.ready/,shortDocReady:/\$\(function/,console:/(^.|\b)console\.(\S+)/g,script:/<\/script/gi,code:/%code%/,csscode:/%css%/,description:/(<meta name="description" content=")([^"]*)/im,title:/<title>(.*)<\/title>/im,winLoad:/window\.onload\s*=/,scriptopen:/<script/gi};return r.prepare=function(t){s.docReady.lastIndex=0,s.shortDocReady.lastIndex=0,s.console.lastIndex=0,s.script.lastIndex=0,s.code.lastIndex=0,s.csscode.lastIndex=0,s.title.lastIndex=0,s.winLoad.lastIndex=0,s.scriptopen.lastIndex=0;var n=[],r=t.html,i=t.javascript||"",c=t.css,d="",l=!!r.trim().length,p=!!c.trim().length,a=!!i.trim().length;if(l&&(i="try {"+i+"\n} catch (error) { throw error; }"),e.alias="window.runnerWindow.protect",i=(i=e(i)).replace(s.script,"<\\/script"),s.console.test(i)&&(i=i.replace(s.console,function(e,t,n){return"window.runnerWindow.proxyConsole."+n})),!l&&a)r="<pre>\n"+i.replace(/[<>&]/g,function(e){return o[e]})+"</pre>";else if(s.code.test(r))r=r.split("%code%").join(code.javascript);else if(a){d="",-1!==r.indexOf("</body>")&&(n.push(r.substring(0,r.lastIndexOf("</body>"))),n.push(r.substring(r.lastIndexOf("</body>"))),r=n[0],d=2===n.length&&n[1]?n[1]:"");r+="<scripttext/script>"+i+"\n<\/script>\n"+d}if(s.console.test(r)){r=r.replace(s.console,function(e,t,n,o){var s=r.lastIndexOf("<script",o),i=r.lastIndexOf("</script",o);return null,s>i?"window.runnerWindow.proxyConsole."+n:e})}return l||a||!p?s.csscode.test(r)?r=r.split("%css%").join(c):l&&(n=[],d="",-1!==r.indexOf("</head>")&&(n.push(r.substring(0,r.indexOf("</head>"))),n.push(r.substring(r.indexOf("</head>"))),r=n[0],d=2===n.length&&n[1]?n[1]:""),r+='<style id="jsbin-css">\n'+c+"\n</style>\n"+d):r="<pre>\n"+c.replace(/[<>&]/g,function(e){return o[e]})+"</pre>",r},t.processor=r});
//# sourceMappingURL=sourcemaps/processor.js.map
