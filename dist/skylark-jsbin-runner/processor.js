/**
 * skylark-jsbin-runner - A version of jsbin-runner  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-runner/
 * @license MIT
 */
define(["skylark-loopprotect","./runner"],function(e,t){"use strict";var n,s={};s.blockingMethods={kill:'<script>(function(){window.__blocked={methods:["open","print","alert","prompt","confirm"],old:{}};for(var m in __blocked.methods){try {__blocked.old[m]=window[m];window[m]=function(){};}catch(e){}}})()<\/script>',restore:"\x3c!--jsbin live harness--\x3e<script>(function(){for(var m in __blocked.methods){try{window[m]=__blocked.old[m];delete __blocked;}catch(e){}};})()<\/script>"},s.getDoctype=(n=/<!doctype [\s\S]*?>/i,function(e){var t=(e.match(n)||[""])[0];return{doctype:t,tail:e.substr(t.length)}}),s.debug=function(e){return"<pre>"+e.replace(/[<>&]/g,function(e){return"<"==e?"&lt;":">"==e?"&gt;":"&"==e?"&amp;":void 0})+"</pre>"},s.render=function(e,t){t=t||{},e=e||"";var n=[],r=!0!==t.requested,i=!1===t.includeJsInRealtime;r&&i&&(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),e=e.replace(/(<.*?\s)(autofocus)/g,"$1");var o=s.getDoctype(e),c=o.doctype;return e=o.tail,n.push(c),r&&t.includeJsInRealtime&&n.push(s.blockingMethods.kill),n.push(e),r&&t.includeJsInRealtime&&n.push(s.blockingMethods.restore),t.debug?s.debug(n.join("\n")):n.join("\n")};var r={"<":"&lt;",">":"&gt;","&":"&amp;"},i={docReady:/\$\(document\)\.ready/,shortDocReady:/\$\(function/,console:/(^.|\b)console\.(\S+)/g,script:/<\/script/gi,code:/%code%/,csscode:/%css%/,description:/(<meta name="description" content=")([^"]*)/im,title:/<title>(.*)<\/title>/im,winLoad:/window\.onload\s*=/,scriptopen:/<script/gi};return s.prepare=function(t){i.docReady.lastIndex=0,i.shortDocReady.lastIndex=0,i.console.lastIndex=0,i.script.lastIndex=0,i.code.lastIndex=0,i.csscode.lastIndex=0,i.title.lastIndex=0,i.winLoad.lastIndex=0,i.scriptopen.lastIndex=0;var n=[],s=t.html,o=nojs?"":t.javascript,c=t.css,d="",l=!!s.trim().length,p=!!c.trim().length,a=!!o.trim().length;if(l&&(o="try {"+o+"\n} catch (error) { throw error; }"),e.alias="window.runnerWindow.protect",o=(o=e(o)).replace(i.script,"<\\/script"),i.console.test(o)&&(o=o.replace(i.console,function(e,t,n){return"window.runnerWindow.proxyConsole."+n})),!l&&a)s="<pre>\n"+o.replace(/[<>&]/g,function(e){return r[e]})+"</pre>";else if(i.code.test(s))s=s.split("%code%").join(code.javascript);else if(a){d="",-1!==s.indexOf("</body>")&&(n.push(s.substring(0,s.lastIndexOf("</body>"))),n.push(s.substring(s.lastIndexOf("</body>"))),s=n[0],d=2===n.length&&n[1]?n[1]:"");var u=jsbin.panels.named.javascript.type?' type="text/'+jsbin.panels.named.javascript.type+'"':"";o+="\n\n//# sourceURL="+jsbin.state.code+".js",s+="<script"+u+">"+o+"\n<\/script>\n"+d}if(i.console.test(s)){s=s.replace(i.console,function(e,t,n,r){var i=s.lastIndexOf("<script",r),o=s.lastIndexOf("</script",r);return null,i>o?"window.runnerWindow.proxyConsole."+n:e})}if(l||a||!p){if(i.csscode.test(s))s=s.split("%css%").join(c);else if(l){if(n=[],d="",-1!==s.indexOf("</head>")&&(n.push(s.substring(0,s.indexOf("</head>"))),n.push(s.substring(s.indexOf("</head>"))),s=n[0],d=2===n.length&&n[1]?n[1]:""),jsbin.state.hasBody&&"css"===jsbin.panels.focused.id)return c;s+='<style id="jsbin-css">\n'+c+"\n</style>\n"+d}}else s="<pre>\n"+c.replace(/[<>&]/g,function(e){return r[e]})+"</pre>";return jsbin.ie&&i.scriptopen.test(s)&&(s=s.replace(/<script(.*?)>/gi,function(e,t){return-1!==t.indexOf("src")?e:"<script defer"+t+">"})),s},t.processor=s});
//# sourceMappingURL=sourcemaps/processor.js.map
